<!DOCTYPE HTML>
<html>
<head>
 <meta charset="UTF-8">
 <title>Chenk Mail</title>
 <script src="https://www.google.com/jsapi" type="text/javascript"></script>
 <script src="/static/lib/jquery-ui-1.8.16.custom/js/jquery-1.6.2.min.js" type="text/javascript"></script>
 <script src="/static/lib/jquery-ui-1.8.16.custom/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
 <script src="/static/lib/closure-library/closure/goog/base.js" type="text/javascript"></script>
 
 <link rel="stylesheet" href="/static/lib/jquery-ui-1.8.16.custom/css/custom-theme/jquery-ui-1.8.16.custom.css" />
 <link rel="stylesheet" href="/static/lib/lion-buttons/styles.css" />
 <link rel="stylesheet" href="/static/lib/google-buttons/styles.css" />
 <link rel="stylesheet" href="/static/css/base.css" />

 <script type="text/javascript">
    var email_data = [];
    $(function(){
            // tabs setup
            $("#namelist").tabs();
            
            $("li.profs").click(function(){
                    if ($(this).hasClass("selected")){

                    } else {
                        email_data.push($(this).attr('email'));
                        $(this).addClass("selected");
                    }
                });

            $('#id_reset').click(function(){
                    $("input,textarea").val("");
                });

            $('#id_submit').click(function(){
                $(this).attr('disabled', 'true'); 
                $(this)[0].inner_HTML = 'Handling';

                var receivers = email_data.join(',');
                var topic = $("#data-topic").val();
                var content = $("#data-content").val();

                $.ajax({
                    url: '/mail/ajax/sendmail',
                    type: 'POST',
                    data: {
                        'emails': receivers,
                        'topic': topic,
                        'content': content,
                        'csrfmiddlewaretoken': $("#csrf input")[0].value
                    },
                    dataType: 'json',
                    beforeSend: function(){},
                    success: function(data){
                        console.debug(data);
                        alert(data.msg);
                        if (data.status == true) {
                            location.reload(true);
                        }
                    }
                    });

                });
    });

 </script>

</head>
<body>
    <div id="csrf" style="display: none;">
        {% csrf_token %}
    </div>
    <header>
        <div id="header_inner">
            <img id="logo" src="/static/img/logo.gif" alt="Chenk mail logo." />

        </div>
        <div id="header_right">
            <a href="/mail/logout" id="logout_button" class="lion-button">Logout</a>
        </div>
    </header>
    <section id="content">
        <div id="col-left">
            <div id="namelist">
                <ul>
                    <li><a href="#tab-1">老師</a></li>
                </ul>
                <div id="tab-1" class="namelist">
                    <ul>
                        {% for professor in professors %}
                        <li class="profs" pid="{{ professor.id }}" email="{{ professor.email }}" fullname="{{ professor.full_name }}">
                            <a class="google-button">{{ professor.full_name }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div id="col-right">
            <div id="compose">
                <div id="field-sendor">
                    <dt>寄件人：</dt>
                    <dd>{{ user.last_name }}{{ user.first_name }} {{ user.email }}</dd>
                </div>
                <div id="field-topic">
                    <dt>主旨：</dt>
                    <dd><input type="text" class="inputfield" id="data-topic"/></dd>
                </div>
                <div id="field-content">
                    <dt>內文：</dt>
                    <dd>
                        <textarea id="data-content"></textarea>
                    </dd>
                </div>
                <div id="compose-controls">
                    <a href="#" class="google-button" id="id_submit">Submit</a>
                    <a href="#" class="google-button" id="id_reset">Reset</a>
                </div>
            </div> 
        </div>
    </section>
    
</body>
</html>
